## 对微软用户词典.dat文件的格式分析

### 实验1, qwerty

依次添加以下词条:

| 拼音 | 位置 | 输出 |
| --- | --- | --- |
| q | 1 | 一 |
| w | 2 | 二 |
| e | 3 | 三 |
| r | 4 | 四 |
| t | 5 | 五 |
| y | 6 | 六 |

观察.dat文件内容变化.

分析过程略.

结论: 
- 记n为条目数
- .dat文件为二进制格式
- .dat文件格式只有前缀, 没有后缀.
- .dat文件的前缀长度为16+n字 (即64+4n字节), 后面跟着每个条目.
- 每个条目占用6个字 (即24个字节).

前缀格式:
```binary
0000: 6D 73 63 68 78 75 64 70 02 00 60 00 01 00 00 00
0010: 40 00 00 00 [v0] 00 00 00 [v1] 00 00 00 [v2] 00 00 00
0020: [-- -- v3 --] 00 00 00 00 00 00 00 00 00 00 00 00
0030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0040: [v4 00 00 00]*n
```
其中
- 记n为条目数
- `v0=0x40+4*n`
- `v1=0x40+28*n`
  - 之所以是28, 很可能是因为每个条目占用7个字, 所以每个条目占用28字节. 因此v1的含义很可能是文件整体长度.
  - 后来发现不是这样. 每个条目占用6个字, 同时每个条目又会在开头增加一个指针, 因此每个条目使整体长度增加7个字, 但本体其实只占用6个字.
- `v2=n`, 很可能记载着条目数.
- `v3`很可能是时间戳, 因为其大小顺序与笔者乱序导出的次序一致.
- `v4=0x18*i`, 0<=i<=n-1, 很可能是每个条目的偏移量.

考虑到v0, v1, v2的格式, .dat文件很可能采用小端法存储数据. 另一种情况基本可以排除 (即分割位置不对, 文件按大端法存储数据的情况), 排除的理由就是v3时间戳.

条目内容汇总:
```binary
q 1 一
10 00 10 00 14 00 01 06 00 00 00 00 [46 A1 D5 2E] 71 00 00 00 00 4E 00 00 in q, qw, qwe, qwer, qwert, qwerty

w 2 二
10 00 10 00 14 00 02 06 00 00 00 00 [6D A6 D5 2E] 77 00 00 00 8C 4E 00 00 in qwe, qwer
10 00 10 00 14 00 02 06 00 00 00 00 [51 A1 D5 2E] 77 00 00 00 8C 4E 00 00 in qw, qwert, qwerty

e 3 三
10 00 10 00 14 00 03 06 00 00 00 00 [76 A6 D5 2E] 65 00 00 00 09 4E 00 00 in qwe, qwer
10 00 10 00 14 00 03 06 00 00 00 00 [5C A1 D5 2E] 65 00 00 00 09 4E 00 00 in qwert, qwerty

r 4 四
10 00 10 00 14 00 04 06 00 00 00 00 [89 A6 D5 2E] 72 00 00 00 DB 56 00 00 in qwer
10 00 10 00 14 00 04 06 00 00 00 00 [64 A1 D5 2E] 72 00 00 00 DB 56 00 00 in qwert, qwerty

t 5 五
10 00 10 00 14 00 05 06 00 00 00 00 [74 A1 D5 2E] 74 00 00 00 94 4E 00 00 in qwert

y 6 六
10 00 10 00 14 00 06 06 00 00 00 00 [7B A1 D5 2E] 79 00 00 00 6D 51 00 00 in qwerty

```

